<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>正和生醫後台 - 名單管理 (Module D)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --card: #ffffff; --text: #0f172a; --muted:#64748b;}
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans TC', 'Helvetica Neue', Arial, 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; color: var(--text); }
        .sidebar { width: 250px; background: #0b1222; color: white; display: flex; flex-direction: column; padding: 20px; }
        .sidebar h2 { font-size: 1.2rem; margin-bottom: 1.5rem; color: #38bdf8; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px 14px; color: #9aa7bf; text-decoration: none; border-radius: 8px; margin-bottom: 6px; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .nav-item:hover { background: #152036; color: #fff; }
        .nav-item.active { background: #1b2a4a; color: #fff; }
        .main { flex: 1; padding: 24px 28px; overflow-y: auto; }
        h1 { margin: 0 0 16px 0; font-size: 1.6rem; }
        /* Filter Bar */
        .filter-bar { background: white; padding: 16px; border-radius: 12px; display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.06); border:1px solid #e2e8f0; }
        .filter-group { display: flex; flex-direction: column; gap: 6px; }
        .filter-group label { font-size: 0.85rem; font-weight: 700; color: var(--muted); }
        .form-control { padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; min-width: 160px; background:#fff; color:#0f172a; }
        .btn { padding: 9px 14px; border-radius: 8px; border: 1px solid transparent; cursor: pointer; font-weight: 700; transition:.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { filter: brightness(1.05); transform: translateY(-1px); }
        .btn-outline { background: white; border: 1px solid #cbd5e1; color: #475569; }
        .btn-outline:hover { background:#f8fafc; }
        /* Data Grid */
        .data-grid { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 6px 14px -8px rgba(0,0,0,0.25); border:1px solid #e2e8f0; }
        .table-wrap { max-height: 520px; overflow:auto; }
        table { width: 100%; border-collapse: collapse; }
        thead th { position: sticky; top: 0; z-index: 1; background: #f8fafc; }
        th { text-align: left; padding: 14px; color: #475569; font-weight: 800; border-bottom: 1px solid #e2e8f0; font-size: 0.92rem; }
        td { padding: 14px; border-bottom: 1px solid #f1f5f9; color: #0f172a; font-size: 0.95rem; }
        tr:hover td { background:#f8fafc; }
        .actions i { color:#94a3b8; cursor:pointer; padding:6px; border-radius:6px; }
        .actions i:hover { background:#eef2f7; color:#475569; }
        .tier-tag { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 800; background: #e2e8f0; color: #475569; }
        .tier-5 { background: #000; color: #ffd700; border: 1px solid #ffd700; }
        .tier-4 { background: #4f46e5; color: white; }
        .tier-1 { background: #94a3b8; color: white; }
        .tag-pill { display: inline-block; background: #e0f2fe; color: #0284c7; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-right: 6px; }
        .table-footer { padding: 12px 14px; display:flex; justify-content: space-between; color: var(--muted); font-size: 0.92rem; align-items:center; }
        .bulk-actions { display:flex; gap:8px; }
        .link { color: var(--primary); cursor:pointer; }
        /* Responsive */
        @media (max-width: 720px) {
          .sidebar { position: fixed; z-index: 20; transform: translateX(-100%); transition: .3s; }
          .sidebar.open { transform: translateX(0); }
          .main { padding: 16px; }
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h2><i class="fa-solid fa-heart-pulse"></i> 正和生醫</h2>
        <a href="module_a.html" class="nav-item"><i class="fa-solid fa-chart-line"></i> 營運與財務 (A)</a>
        <a href="module_b.html" class="nav-item"><i class="fa-solid fa-user-clock"></i> 產能分析 (B)</a>
        <a href="module_c.html" class="nav-item"><i class="fa-solid fa-users"></i> 客戶結構 (C)</a>
        <a href="module_d.html" class="nav-item active"><i class="fa-solid fa-list-check"></i> 名單管理 (D)</a>
        <a href="module_e.html" class="nav-item"><i class="fa-solid fa-bullhorn"></i> 行銷成效 (E)</a>
        <a href="module_crm_core.html" class="nav-item"><i class="fa-solid fa-headset"></i> CRM 核心</a>
    </div>

    <div class="main">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h1>名單管理與分級 (D-1 / D-2)</h1>
            <div style="display:flex; gap:8px;">
                <button class="btn btn-outline" id="toggleMenu" title="開合側邊選單"><i class="fa-solid fa-bars"></i></button>
                <button class="btn btn-outline" id="exportBtn"><i class="fa-regular fa-file-excel"></i> 匯出 Excel</button>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-group">
                <label>客戶分級 (Tier)</label>
                <select class="form-control" id="tierSelect">
                    <option value="all">全部等級</option>
                    <option value="5">Level 5 (VVIP)</option>
                    <option value="4">Level 4 (VIP)</option>
                    <option value="1">Level 1 (新客)</option>
                </select>
            </div>
            <div class="filter-group">
                <label>來館次數</label>
                <select class="form-control" id="visitSelect">
                    <option value="any">不限</option>
                    <option value="gt10">> 10 次</option>
                    <option value="eq1">1 次 (單次客)</option>
                </select>
            </div>
            <div class="filter-group">
                <label>標籤篩選</label>
                <input type="text" class="form-control" id="tagInput" placeholder="例: 董事長, 股東...">
            </div>
            <div class="filter-group">
                <label>服務人員 (權限控管)</label>
                <select class="form-control" disabled style="background: #e2e8f0; cursor: not-allowed;">
                    <option>陳醫師 (Current User)</option>
                </select>
            </div>
            <button class="btn btn-primary" id="searchBtn" style="margin-bottom: 2px;">搜尋</button>
            <button class="btn btn-outline" id="resetBtn" style="margin-bottom: 2px;">清除</button>
        </div>

        <!-- Data Grid -->
        <div class="data-grid">
            <div class="table-wrap">
                <table id="listTable">
                    <thead>
                        <tr>
                            <th style="width: 50px;"><input type="checkbox" id="checkAll"></th>
                            <th>姓名</th>
                            <th>手機</th>
                            <th>系統分級 (Tier)</th>
                            <th>最近來館日</th>
                            <th>累積消費</th>
                            <th>標籤 (Tag)</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-tier="5" data-visits="28" data-tags="股東,腰椎主訴">
                            <td><input type="checkbox" class="rowCheck"></td>
                            <td>王大明</td>
                            <td>0912-345-678</td>
                            <td><span class="tier-tag tier-5">Level 5</span></td>
                            <td>2023-12-25</td>
                            <td>$250,000</td>
                            <td>
                                <span class="tag-pill">股東</span>
                                <span class="tag-pill">腰椎主訴</span>
                            </td>
                            <td class="actions"><i class="fa-solid fa-ellipsis-vertical" title="更多"></i></td>
                        </tr>
                        <tr data-tier="4" data-visits="12" data-tags="VIP">
                            <td><input type="checkbox" class="rowCheck"></td>
                            <td>李小美</td>
                            <td>0988-765-432</td>
                            <td><span class="tier-tag tier-4">Level 4</span></td>
                            <td>2023-11-10</td>
                            <td>$88,000</td>
                            <td>
                                <span class="tag-pill">VIP</span>
                            </td>
                            <td class="actions"><i class="fa-solid fa-ellipsis-vertical" title="更多"></i></td>
                        </tr>
                        <tr data-tier="1" data-visits="1" data-tags="新客,體驗價">
                            <td><input type="checkbox" class="rowCheck"></td>
                            <td>陳志豪</td>
                            <td>0911-222-333</td>
                            <td><span class="tier-tag tier-1">Level 1</span></td>
                            <td>2023-10-01</td>
                            <td>$3,500</td>
                            <td>
                                <span class="tag-pill">新客</span>
                                <span class="tag-pill">體驗價</span>
                            </td>
                            <td class="actions"><i class="fa-solid fa-ellipsis-vertical" title="更多"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-footer">
                <div>顯示 1-3 筆，共 1,520 筆</div>
                <div class="bulk-actions">
                    <span class="link" id="selectAllLink">全選</span>
                    <span class="link" id="clearSelectLink">清空選取</span>
                    <button class="btn btn-primary" id="bulkExport"><i class="fa-solid fa-file-export"></i> 匯出選取</button>
                </div>
            </div>
        </div>
    </div>

    <script>
      // 側邊選單（行動裝置）
      const toggleMenu = document.getElementById('toggleMenu');
      const sidebar = document.getElementById('sidebar');
      toggleMenu?.addEventListener('click', () => sidebar.classList.toggle('open'));

      // 匯出提示
      document.getElementById('exportBtn')?.addEventListener('click', () => {
        alert('原型功能：匯出目前篩選結果（尚未串接後端）。');
      });
      document.getElementById('bulkExport')?.addEventListener('click', () => {
        const checked = document.querySelectorAll('.rowCheck:checked');
        alert(`原型功能：將匯出 ${checked.length} 筆選取資料（尚未串接）。`);
      });

      // 全選 / 單選
      const checkAll = document.getElementById('checkAll');
      const rowChecks = () => document.querySelectorAll('.rowCheck');
      checkAll?.addEventListener('change', (e) => {
        rowChecks().forEach(chk => chk.checked = e.target.checked);
      });
      document.querySelectorAll('.rowCheck').forEach(chk => {
        chk.addEventListener('change', () => {
          const all = rowChecks();
          const allChecked = Array.from(all).every(c => c.checked);
          checkAll.checked = allChecked;
        });
      });
      document.getElementById('selectAllLink')?.addEventListener('click', () => {
        rowChecks().forEach(chk => chk.checked = true);
        checkAll.checked = true;
      });
      document.getElementById('clearSelectLink')?.addEventListener('click', () => {
        rowChecks().forEach(chk => chk.checked = false);
        checkAll.checked = false;
      });

      // 搜尋/清除（原型過濾，依 data-* 屬性）
      const tierSelect = document.getElementById('tierSelect');
      const visitSelect = document.getElementById('visitSelect');
      const tagInput = document.getElementById('tagInput');
      const searchBtn = document.getElementById('searchBtn');
      const resetBtn = document.getElementById('resetBtn');

      function applyFilter() {
        const tier = tierSelect.value;   // all | 5 | 4 | 1
        const visit = visitSelect.value; // any | gt10 | eq1
        const tagKeyword = (tagInput.value || '').trim().toLowerCase();
        let visible = 0;
        document.querySelectorAll('#listTable tbody tr').forEach(tr => {
          const t = tr.getAttribute('data-tier');
          const v = parseInt(tr.getAttribute('data-visits') || '0', 10);
          const tags = (tr.getAttribute('data-tags') || '').toLowerCase();
          let ok = true;
          if (tier !== 'all' && t !== tier) ok = false;
          if (visit === 'gt10' && !(v > 10)) ok = false;
          if (visit === 'eq1' && v !== 1) ok = false;
          if (tagKeyword && !tags.includes(tagKeyword)) ok = false;
          tr.style.display = ok ? '' : 'none';
          if (ok) visible++;
        });
        // 更新顯示數（原型）
        const footer = document.querySelector('.table-footer div:first-child');
        if (footer) footer.textContent = `顯示 ${visible} 筆，共 1,520 筆`;
      }
      searchBtn?.addEventListener('click', applyFilter);
      resetBtn?.addEventListener('click', () => {
        tierSelect.value = 'all';
        visitSelect.value = 'any';
        tagInput.value = '';
        applyFilter();
      });
    </script>
</body>
</html>